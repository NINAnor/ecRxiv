---
title: "Water level regulation"
subtitle: "[NO_WLEV_001]"
format: 
  html:
    embed-resources: true
    code-fold: true
    toc: true
    toc-title: Contents
    toc-depth: 3
    smooth-scroll: true
execute: 
  cache: true
author:
  - name: Hanno Sandvik
    email: hanno.sandvik@nina.no
    affiliations:
      - id: myID
        name: Norwegian Institute for Nature Research
date: September 24, 2025 
callout-icon: false
lightbox: true
css: ../../../style.css
code-links:
      - text: Add a review
        icon: github
        href: https://github.com/NINAnor/ecRxiv
---

<!--# This is a template for how to document the indicator analyses. Make sure also to not change the order, or modify, the headers, unless you really need to. This is because it easier to read if all the indicators are presented using the same layout. If there is one header where you don't have anything to write, just leave the header as is, and don't write anything below it. If you are providing code, be careful to annotate and comment on every step in the analysis. Before starting it is recommended to fill in as much as you can in the metadata file. This file will populate the initial table in your output.-->

<!--# Load all you dependencies here -->

```{r setup}
#| include: false
library(knitr)
library(tidyverse)
library(kableExtra)
library(here)
knitr::opts_chunk$set(echo = TRUE)

library(foreign)
library(sf)
library(readxl)
library(httr)
library(jsonlite)
library(sp)
```

```{r source}
#| echo: false
source(here::here("_common.R"))
```

```{r}
#| echo: false
meta <- readxl::read_xlsx("../metadata.xlsx")
st <- meta |>
  filter(Variable == "status") |>
  pull(Value)
version <- meta |>
  filter(Variable == "Version") |>
  pull(Value)
auth <- meta |>
  filter(Variable == "authors") |>
  pull(Value)
year <- meta |>
  filter(Variable == "yearAdded") |>
  pull(Value)
id <- meta |>
  filter(Variable == "indicatorID") |>
  pull(Value)
name <- meta |>
  filter(Variable == "indicatorName") |>
  pull(Value)
url <- meta |>
  filter(Variable == "url") |>
  pull(Value)

meta <- meta |>
  mutate(Variable = case_match(Variable,
    "indicatorID" ~ "Indicator ID" ,
    "indicatorName" ~ "Indicator Name",
    "country" ~ "Country",
    "continent" ~ "Continent",
    "ECT" ~ "Ecosystem Condition Typology Class",
    "yearAdded" ~ "Year added",
    "yearLastUpdate" ~ "Last update",
    .default = Variable
   )
  ) |>
  filter(Variable != "authors")

```

<!--# The following parts are autogenerated. Do not edit. -->

```{r}
#| echo: false
#| results: asis
status(st)
```

::: {layout-ncol="2"}



> **Recomended citation**: `r paste(auth, " ", year, ". ", name, " (ID: ", id, ") ", "v. ", version, ". ecRxiv: https://view.nina.no/ecRxiv/", sep="")`

> **Version**: `r version`

:::

```{=html}
<details>
<summary>Show metadata</summary>
```

```{r tbl-meta}
#| tbl-cap: 'Indicator metadata'
#| echo: false
#| warning: false

meta |>
  select(Variable, Value) |>
  kbl(col.names = NULL) 

```

```{=html}
</details>
```

::: {.callout-tip collapse="true"}

## Logg

<!--# Update this logg with short messages for each update -->
- 15 May 2025 - Version 001.000 started: first complete version
- 24 Sep 2025 - Version 001.000 submitted to review
:::


<hr />

<!--# Document you work below.  -->

## 1. Summary

Lake ecosystems are negatively affected by anthropogenic activities that lead to variation in water level, such as emptying and refilling lakes that have been dammed (reservoirs), e.g. for hydroelectric power production. 
Such anthropogenic water level variation negatively affects macrophytes and invertebrates as well as the fish fauna of the reservoirs. 

The indicator *water level regulation* attempts to capture the impact of anthropogenic water level variation on lake fish fauna. 
This impact is mediated by effects of water level regulation on prey species as well as the accessibility of spawning habitat. 

The steps in estimating indicator values can be summarised as follows:

* Downloading public information on the lowest and highest regulated water level of Norwegian reservoirs.
* Calculating regulation height as the difference between the highest and lowest regulated water level.
* Estimating missing values of regulation height based on reservoir area and dammed volume, where available.
* Inferring remaining missing values based on the distribution of known regulation heights.
* Using a re-sampling procedure to estimate prediction intervals.
* Scaling and transforming measurements to "modified Ecological Quality Ratios" according to the normative definitions for "ecological status" categories provided by the Water Framework Directive.
* Aggregating estimates geographically using area-weighted averages.
* Truncating the values obtained to the interval from 0 to 1.

> ### Interpretation
An indicator value of 1 signifies a condition where there is little or no human impact on the water body. Values decreasing toward zero reflect negative ecological change, specifically a larger (impact of) water level variation due to lake regulation.

<!--# 
With a maximum of 300 words, describe the indicator in general terms as you would to a non-expert. Think of this as a kind of commmon language summary. It is a good idea to include a bullet point list of the spesific steps in the workflow. Include a mention of the following aspects:

What does the metric represent?
Why is this relevant for describing ecosystem condition in this ecosystem?
What are the main anthropogenig impact factors?
What kind of data is used? 
Shortly, how is the data customized (modified, estimated, integarted) to fit its purpuse as an indicator?
What is the current status of  the metric (can it be used or is it still in development)?
How should the metric be used and interpretted, and how should it not be used/interpretted?
-->


## 2. About the underlying data

The underlying data come from two datasets maintained by the Norwegian Water Resources and Energy Directorate ([NVE](https://www.nve.no/)). 
One is the [*Innsjødatabase*](#innsj) ("lake database"), containing information on the more than 260,000 Norwegian lakes with an area of at least 2500&nbsp;m² (location, area, altitude etc.).
[The other](#vannk) contains technical information on the subset of lakes that are reservoirs (type, age, highest and lowest regulated water level, dammed volume etc.).

<!--# Describe the data you have used in more detail, it's origin, biases, availability ect.-->

### 2.1 Spatial and temporal resolution and extent

The **spatial** resolution is on the level of individual lakes. The **temporal** resolution is daily (i.e., update frequency of the datasets; the current rate of change is far lower, viz. a few reservoirs per decade).

<!--# Describe the temporal and spatial resolution and extent of the data used -->

### 2.2 Sampling design

The NVE datasets are sampled exhaustively, in the sense that all lakes that fulfil the defining criteria are included (an area of at least 2500&nbsp;m² for the *Innsjødatabase*; water level regulation for the reservoir dataset). 
In the case of the reservoir dataset, however, there are many missing values for regulation height. 
This may introduce a certain sampling bias of unknown sign and magnitude.

<!-- How was the data sampled? Describe potential sampling biases -->

### 2.3 Original units

Water level regulation is expressed as the regulation height of the water level of a reservoir, measured in metres. 
"Regulation height" (Norw. *reguleringshøyde*) is the difference between the highest regulated water level and the lowest regulated water level, which are both measured in metres above sea level.

<!--# What are the original units for the most relevant  variables in the data-->

### 2.4 Instructions for citing, using and accessing data

For suggestions on how to cite the datasets, see [*Innsjødatabase*](#innsj) and [*Vannkraft*](#vannk). 
The data used are publicly available but not machine-readable. 
They need to be downloaded manually from [https://nedlasting.nve.no/gis/](https://nedlasting.nve.no/gis/). 
For further details, see [chapter&nbsp;7](#import-and-prepare-datasets) below.

<!--# Is the data openly available? If not, how can one access it? What are the key references to the datasets?   -->


## 3. Indicator properties

Water level regulation has the ID **79** in the metadata table for ecological condition variables for use in Norway ([Czúcz et al. 2023](#czu23)).

As such, the water level regulation of lakes is a pressure variable, not an ecosystem condition variable. 
However, some attempts to measure the ecological effect of water level regulation have been made ([DGVF 2025](#veil2)). 
Known effects on invertebrates are summarised in DGVF ([2025](#veil2), Table 6.20), although merely qualitatively, or in terms of tolerance thresholds. 
Based on observed effects on macrophytes, Mjelde et al. ([2013](#mje13), [Hellsten & Mjelde 2009](#hel09); Tables 4.7 and V4.2.7 in [DGVF 2025](#veil2)) have designed the WIc indicator, which, however, so far lacks imortant reference values and has far too few datapoints in Norway to allow an estimation of indicator values. 
Finally, DGVF ([2025](#veil2), Table 6.19) defines "tentative" reference levels for an index that is based on average responses of the lake fish community to water level regulation. 
In the absence of any better alternative, the latter index is used here.

### 3.1 Ecosystem Condition Typology Class (ECT)

The ECT of water level regulation is **A1** (physical state) because the indicator measures the physical modification of the lake level.

**B1** (compositional state) may be regarded as a *secondary* ECT class of water level regulation, as the index is expressed in terms of the average effect of water level regulation on the fish fauna present, which is a measure of *biodiversity*.

<!--# 
Describe the rationale for assigning the indicator to the ECT class. See https://oneecosystem.pensoft.net/article/58218/
This doesnt need to be very long. Maybe just a single sentence. 
-->

#### 3.1.1 Other condition typologies

In the Norwegian classification of ecological characteristics (*økologiske egenskaper*) according to Nybø & Evju ([2017](#nyb17), p.&nbsp;35), the indicator represents **abiotic conditions** (*abiotiske forhold*).

Among the *quality elements* distinguished in the Water Framework Directive, the indicator belongs to the *supporting hydromorphological elements*, representing **lake depth variation** ([WFD](#wfd), Annex&nbsp;V).

<!--# Optional: Add text about other standards or typologies, such as alternative national condition typologies, and how the indicator relates to these -->

### 3.2 Ecosystem condition characteristic

Intact lakes are characterised by having no or little water level variation (rarely more than a few centimetres), and water level regulation represents a physical alteration of lakes. 
The fish community responds to water level regulation because important prey taxa are absent and/or because spawning habitats become inaccessible when the water level variation is too high.

<!--# 
Describe the ecosystem condition characteristic represented in the indicator. See 10.3897/oneeco.6.e58218 for information on what these characteristics might be.
For example, and indicator called 'Trenching in mires' could be made to represent an ecosystem characteristic 'Intact hydrology'. The term 'characteristic' is used similar to the term 'criteria' in Multiple Criteria Decition Making.  
-->

### 3.3 Collinearities with other indicators

No known collinearities with other Ecosystem Condition indicators exist.

<!--# Describe known collinearities with other metrices (indicators or variables) that could become problematic if they were also included in the same Ecosystem Condition Assessment as the indicator described here. -->

### 3.4 Impact factors

Water level regulation represents a physical alteration of lakes.

<!--# Describe the main natural and anthropogenic factors that affecst the metric -->

### 3.5 Spatial aggregation

Spatial aggregation is here carried out after scaling and transformation but before truncation. 
The aggregation pathway thus largely follows Sandvik ([2019](#san19), [2025](#san25)) and consists of the following steps:

1. *Scaling.* The raw variable values are linearly scaled so that X~0~ becomes 0 and X~100~ becomes 1. Note that the resulting values may be negative (if X is poorer than X~0~).
2. *Transformation.* The scaled values are transformed in a stepwise-linear manner in accordance with the [reference levels](#reference-levels). The resulting values are here referred to as **mEQR**s ("modified Ecological Quality Ratios"). This step requires an adjustment when values of X are much higher than X~0~; the approach chosen here ensures that no indicator value can be below &minus;0.2 (described, in Norwegian, [here](https://github.com/NINAnor/WFD2ECA/blob/main/forklar/asympEQR.md)).
3. *Aggregration.* The mEQR values are spatially aggregated using area-weighted arithmetic averages.
4. *Truncation.* When the aggregated values are truncated (if necessary) to the interval from 0 to 1 in a final step, they become indicator values sensu SEEA&nbsp;EA.

<!-- Describe in word the same aggregation pathway presented in the metadata.xlsx. If you have scaled against the reference value, it is especially important to know if you did any avergaing or summations etc. beforehand. An example text for a rather simple case could be: "The variable is scaled at the initial polygon level and the point estimate is a area-weighted arithmetic mean of all polygins. There is no transformation, and truncation is not needed as the indicator becomes naturally bound between 0 and 1". -->


## 4. Reference condition and levels

### 4.1 Reference condition

The [*Water Framework Directive*](#wfd) (hereafter **WFD**) defines the reference condition of a water body as "the condition of a quality element where there is little or no human impact on the water body. The reference condition is therefore also referred to as the natural condition" ([DGVF 2025](#veil2)).

<!--# Define the reference condition (or refer to where it is defined). Note the distinction between reference condition and reference levels 10.3897/oneeco.5.e58216  -->

### 4.2 Reference levels

According to the WFD, reference levels are defined for X~0~, X~20~, X~40~, X~60~, X~80~, and X~100~. 
These are used to classify the "ecological status" of water bodies as "bad" (X~0~ &le; X &le; X~20~), "poor" (X~20~ < X &le; X~40~), "moderate" (X~40~ < X &le; X~60~), "good" (X~60~ < X &le; X~80~), and "high" (X~80~ < X &le; X~100~). 
The WFD (Annex&nbsp;V, section&nbsp;1.2) provides the following normative definition of "high status": 
"The values of the biological quality elements for the surface water body reflect those normally associated with that type under undisturbed conditions, and show no, or only very minor, evidence of distortion."

Reference levels for water level regulation (more specific, its effects on the fish fauna) are provided in Table 6.19 of DGVF ([2025](#veil2)) as follows: X~80~&nbsp;=&nbsp;1&nbsp;m, X~60~&nbsp;=&nbsp;5&nbsp;m, X~40~&nbsp;=&nbsp;8&nbsp;m, and X~20~&nbsp;=&nbsp;12&nbsp;m. 
The Table does not specify values for X~100~ (which can be assumed to be 0, i.e. the absence of water level regulation) and X~0~ (which is here arbitrarily defined as twice the value of X~20~).

```{r}
klassegrenser <- c(Pess = 240,
                   X0   =  24,
                   X20  =  12,
                   X40  =   8,
                   X60  =   5,
                   X80  =   1,
                   X100 =   0,
                   Opt  =   0)
```
<!--# 
If relevant (i.e. if you have normalised a variable), describe the reference levels used to normalise the variable. 

Use the terminology where X~0~ refers to the reference level (the variable value) denoting the worst possible condition; X~100~denotes the optimum or best possible condition; and X~*n*~, where in is between 0 and 100, denotes any other anchoring points linking the variable scale to the indicator scale (e.g. the threshold value between good and bad condition X~60^). 

Why was the current option chosen and how were the reference levels quantified? If the reference values are calculated as part of the analyses further down, please repeat the main information here.
-->

#### 4.2.1 Spatial resolution and validity

The spatial resolution of WFD reference levels is the water body (i.e. lake). 
Currently, reference levels of water level regulation do not differ between lake water body types. 

<!--# 
Describe the spatial resolution of the reference levels. E.g. is it defined as a fixed value for all areas, or does it vary. Also, at what spatial scale are the reference levels valid? For example, if the reference levels have a regional resolution (varies between regions), it might mean that it is only valid and correct to use for normalising local variable values that are first aggregated to regional scale. However, sometimes the reference levels are insensitive to this and can be used to scale variables at the local (e.g. plot) scale. 
-->


## 5. Uncertainties

### 5.1 General uncertainties

The reference levels are still stated to be "tentative" ([DGVF 2025](#veil2)), and it is unknown how representative they are of different lake types (e.g. mountain lakes vs. lowland lakes). 
No attempt is made to quantify this kind of uncertainty.

<!--# Describe the main reasons why you might not trust 100% the final value to represent the given ecosystem characteristic for the give ecosystem type. What aspects of this condition metric are most sensitive to subjective decitions? Is the spatial sampling sufficient? Does the choice of modeling framework affect the values? Is the metric relevant do describe ecosystem condition for the give ecosystem type?  -->

### 5.2 Reported uncertainties

The uncertainties reported are inferential, i.e. they refer to the uncertainty around the point estimates. 
The dataset on water levels used here has almost 50% missing values. 
The procedure described below estimates the unknown values based on the distribution of the known values, and quantifies the uncertainty attached to these inferences using simulations (resampling).

<!-- Describe the nature of the errors you (hopefully) provide alongside the point estimate for the condition metric. It is especially important to clarify if the errors are inferential (referring to the uncertainty of the point estimate) or descriptive (referreing to the data itself). Here' an example text: "What we report as uncertainties in @tbl-finalTable are inferential and refer to the uncertainty around the point estimates. It does not directly describe variation in the data itself. 
However, the variation in the mean is defined by the spatial variation only, and quartiles are obtained by bootstrapping the set of localities within a region, and calculating the indicator for each of 9999 such samples".   -->


## 6. References

<span id="czu23">Czúcz B, Sandvik H, Framstad E & Schartau AK.</span> 2023. Metadata for ecological condition variables for use in Norway, version 1.0. [[doi:10.5281/zenodo.10187828](https://doi.org/10.5281/zenodo.10187828)]

<span id="veil2">DGVF [Direktoratsgruppa for vannforvaltning].</span> 2025. *Veileder for klassifisering av miljøtilstand i kyst- og ferskvann* [version of 28 Jan 2025]. Vannportalen. <https://www.vannportalen.no/veiledere/klassifiseringsveileder/>

<span id="hel09">Hellsten S & Mjelde M.</span> 2009. Macrophyte responses to water level fluctuation in Fennoscandinavian lakes -- applying a common index. *Verh Int Ver Limnol* **30**: 765--769. [[doi:10.1080/03680770.2009.11902235](https://doi.org/10.1080/03680770.2009.11902235)]

<span id="mje13">Mjelde M, Hellsten S & Ecke F.</span> 2013. A water level drawdown index for aquatic macrophytes in Nordic lakes. *Hydrobiologia* **704**: 141--151. [[doi:10.1007/s10750-012-1323-6](https://doi.org/10.1007/s10750-012-1323-6)]

<span id="innsj">NVE [Norges vassdrags- og energidirektorat].</span> 2025. *Innsjødatabase*. <https://www.nve.no/kart/kartdata/vassdragsdata/innsjoedatabase/> (description) and <https://nedlasting.nve.no/gis/> (download)

<span id="vannk">NVE [Norges vassdrags- og energidirektorat].</span> 2025. *Vannkraft: Magasin*. <https://objektkatalog.geonorge.no/Pakke/Index/EAPK_88F1053F_8EE5_437b_859C_CF6EFB0B945A> (metadata) and <https://nedlasting.nve.no/gis/> (download)

<span id="nyb17">Nybø S & Evju M (eds).</span> 2017. *Fagsystem for fastsetting av god økologisk tilstand. Forslag fra et ekspertråd.* Klima- og miljødepartementet, Oslo. <https://www.regjeringen.no/no/dokumenter/fagsystem-for-fastsetting-av-god-okologisk-tilstand/id2558481/>

<span id="san19">Sandvik H.</span> 2019. Ferskvann i vannforskriften og naturindeksen. Forslag til samordning og dataflyt. *NINA Rapp* **1723**: 1--38. [[hdl:11250/2631056](http://hdl.handle.net/11250/2631056)]

<span id="san25">Sandvik H.</span> 2025. WFD2ECA: Dataflyt fra vannforskriften til økologisk tilstandsregnskap og naturindeks, version 2.0. <https://github.com/NINAnor/WFD2ECA> [[doi:10.5281/zenodo.10278000](https://doi.org/10.5281/zenodo.10278000)]

<span id="seeaea">**SEEA EA**:</span> United Nations et al. 2024. *System of Environmental-Economic Accounting -- Ecosystem Accounting.* UN, New York. <https://seea.un.org/ecosystem-accounting>

<span id="wfd">**WFD**:</span> EU. 2000. Directive 2000/60/EC of the European Parliament and of the Council of 23 October 2000 establishing a framework for Community action in the field of water policy. *Off J EU L* **43** (327): 1--72. [[CELEX:32000L0060](http://eur-lex.europa.eu/LexUriServ/LexUriServ.do?uri=CELEX:32000L0060:en:NOT)]
  
<!--# You can add references manually or use a citation manager and add intext citations as with crossreferencing and hyperlinks. See https://quarto.org/docs/authoring/footnotes-and-citations.html -->


## 7. Import and prepare datasets

<!--# Describe the unique datasets seperately under seperate headers (Dataset A, Dataset B, etc.-->

### 7.1 WFD2ECA

The dataflow described here uses some functions and data files from the GitHub repository [WFD2ECA](https://github.com/NINAnor/WFD2ECA/) ([Sandvik 2025](#san25)). 
We start by downloading them from archived version 2.0 of that repo.

```{r}
vannkategori <- "L"

if (!file.exists("../data/NVE.RData")) {
  download.file("https://zenodo.org/records/16811526/files/NINAnor/WFD2ECA-v2.0.zip",
                "../data/WFD2ECA.zip")
  folder <- "../data/WFD2ECA"
  unzip("../data/WFD2ECA.zip", exdir = folder)
  while (length(list.files(folder)) == 1) {
    folder <- paste0(folder, "/", list.files(folder))
  }
  whichDataFile <- c(
    "navnNVEl.csv",
    "Norge.map",
    "NVE.RData"
  )
  dummy <- file.copy(from = paste0(folder, "/data/", whichDataFile),
                     to   = "../data/",
                     overwrite = FALSE)
  dummy <- file.copy(from = list.files(paste0(folder, "/R/"), full.names = TRUE),
                     to   = ".",
                     overwrite = FALSE)
  dummy <- file.remove("../data/WFD2ECA.zip")
  unlink("../data/WFD2ECA", recursive = TRUE)
}
```

Next, we load the functions contained in that repo.

```{r}
source("Funksjon.R")
for (filnavn in list.files(".", full.names = TRUE)) {
  if (substr(filnavn, nchar(filnavn), nchar(filnavn)) %=% "R") {
    source(filnavn)
  }
}
```

### 7.2 Innsjødatabase

Detailed information on Norwegian lakes is available from the [*Innsjødatabase*](#innsj) ("lake database") maintained by the Norwegian Water Resources and Energy Directorate ([NVE](https://www.nve.no/)). 
This dataset is publicly available, but it needs to be downloaded manually:

* Navigate to [https://nedlasting.nve.no/gis/](https://nedlasting.nve.no/gis/).
* Choose (or retain) "Vektordata" in the "Velg datatype" dropdown menu.
* Expand the "Innsjø" heading.
* Tick the "Innsjø" box.
* Click "Neste".
* Choose "ESRI shapefil (.shp)" in the "Velg kartformat" dropdown menu.
* Choose "Geografiske koordinater ETRS89" in the "Velg koordinatsystem" dropdown menu.
* Choose "Overlapper" in the "Velg utvalgsmetode" dropdown menu.
* Choose "Landsdekkende" in the "Velg dekningsområde" dropdown menu.
* Click "Neste".
* Provide your e-mail address in the "E-post" boxes.
* Tick the "Jeg har lest og forstått betingelser..." box to accept the terms of use.
* Upon pressing "Send", a link to a compressed archive (zip) will be sent to your e-mail.
* Click that link to download the data.
* Uncompress the zip archive. (Upon uncompression, the relevant files are located in the folder `NVEKartdata\NVEData\Innsjo`.)
* Place the shapefiles (called `Innsjo_Innsjo.*`) in the "data" folder.

(The [analyses](#analyses) use a cached version called "NVE.RData", which is available via the WFD2ECA repo, see [section&nbsp;7.1](#wfd2eca).)

With the necessary files in place, we can read the export from *Innsjødatabase*.

```{r, eval=FALSE, echo=TRUE}
nve <- lesInnsjodatabasen("Innsjo_Innsjo.dbf")
```
```{r, eval=TRUE, echo=FALSE}
# The shapefile is too huge for GitHub, so a cached version is used instead
nve <- lesInnsjodatabasen("Innsjo_Innsjo.dbf", CACHE = "NVE.RData")
```

The output informs us of a few adjustments made to the data, but that the operation was successful.
This is how the dataset looks like:

```{r}
head(nve)
```

An explanation of the columns (in Norwegian) is given [elsewhere](https://github.com/NINAnor/WFD2ECA/blob/main/forklar/lesInnsjodatabasen.md#funksjonsverdi).

### 7.3 Reservoir dataset

The second dataset is available from the same source as the previous one, and the procedure to access it is analogous:

* Navigate to [https://nedlasting.nve.no/gis/](https://nedlasting.nve.no/gis/).
* Choose (or retain) "Vektordata" in the "Velg datatype" dropdown menu.
* Expand the "Vannkraft" heading.
* Tick the "Magasin" box.
* ... (follow the 5th to 14th bullet point [above](#innsjødatabase)) ...
* Uncompress the zip archive. (Upon uncompression, the relevant files are located in the folder `NVEKartdata\NVEData\Vannkraft`.)
* Place the shapefiles (called `Vannkraft_Magasin.*`) in the "data" folder.

Likewise, we read the data about water reservoirs and define a column for regulation height.

```{r}
mag <- read_sf("../data/Vannkraft_Magasin.shp")
geo <- mag$geometry
mag <- as.data.frame(mag)[, -25]
mag$lat <- mag$long <- NA
for (i in 1:nrow(mag)) {
  mag$lat[i]  <- mean(geo[[i]][[1]][[1]][, 2])
  mag$long[i] <- mean(geo[[i]][[1]][[1]][, 1])
}
mag$lrv_moh[which(mag$lrv_moh < 0)] <- NA
mag$regh <- mag$hrv_moh - mag$lrv_moh
```

This is how the dataset looks like:

```{r}
head(mag)
```

An explanation of the columns (in Norwegian) is given on [Geonorge](https://objektkatalog.geonorge.no/Objekttype/Index/EAID_7A22ADFE_946D_4f75_B12D_4993A37B2183) and in [this pdf](../data/ObjekttyperEgenskaper_Vannkraft.pdf) (p.&nbsp;4).


## 8. Spatial units

Data (measurements) are representative for their respective lakes, which correspond to Ecosystem Assets. 
The Ecosystem Accounting Area covered by the data is mainland Norway. 

<!--# 
Describe the spatial units that you rely on in your analyses. Highlight the spatial units (the resolution) that the indicator values should be interpretted at. Potential spatial delineation data should eb introduced under 7.1. Datasets. We recomend using the SEEA EA terminology opf Basic Spatial Units (BSU), Ecosystem Asses (EA) and Ecosystem Accounting Area (EAA). 
-->

## 9. Analyses

### 9.1 Inspection of the dataset

We can now have an initial look at the data in terms of a map ...

```{r}
#| lab: measurement-map
#| fig-cap: "Map of Norway with points for all reservoirs. Colours indicate unscaled variable values."

{
  xaxis <- seq(-1, 2, 1)
  dig <- 0
  snudd <- TRUE
  
  ml <- mag
  ml$maaling <- lg(ml$regh)
#  ml$maaling[which(ml$maaling < -1)] <- -1
#  ml$maaling[which(ml$maaling > +2)] <- +2
  if (snudd) xaxis <- rev(xaxis)
  xlim <- range(xaxis)
  ml$maaling <- sapply(sapply(ml$maaling, max, xlim[1]), min, xlim[2])
  ml <- ml[order(ml$maaling, decreasing = !snudd), ]
  missing <- ml[ which(is.na(ml$maaling)), ]
  ml      <- ml[-which(is.na(ml$maaling)), ]
  
  load("../data/Norge.map")
  par(mai = rep(0, 4))
  plot(Norge.kontur, xlim = c(3.5, 31.5), ylim = c(57.5, 71.5), 
       xaxs = "i", yaxs = "i", asp = 2, col = grey(0.84), border = NA)
  points(missing$long, missing$lat, pch = 4, cex = 0.6, col = grey(0.6))
  points(ml$long, ml$lat, pch = 20, cex = 0.6, col = if (snudd)
         farve(ml$maaling, xlim[2], xlim[1]) else 
         farve(ml$maaling, xlim[1], xlim[2]))
  text(6, 70, "regulation\nheight", cex = 1.5, font = 2)
  for (i in seq(0, 0.999, 0.001)) {
    rect(24, 59+i*8, 26, 59+(i+0.001)*8, border = NA,
         col = if (snudd) farve(i, 1, 0) else farve(i, 0, 1))
  }
  rect(24, 59, 26, 67, lwd = 2)
  for (i in xaxis) {
    lines(c(24.0,23.6), rep(59 + 8 * (i-xlim[1]) / (xlim[2]-xlim[1]), 2), lwd=2)
  }
  text(23.6, 59 + 8 * (xaxis - xlim[1]) / (xlim[2] - xlim[1]), 
       rev(c(0, 1, 10, 100)), pos = 2)
  text(25, 58.5, "m")
  points(17, 59.5, pch = 4, cex = 0.6, col = grey(0.6))
  text(17, 59.0, "missing")
  text(17, 58.5, "data")
}
```

... and a summary table.

```{r}
{
  cat("Data points in the regulation dataset: " %+% nrow(mag) %+%
      " reservoirs\n\nSummary of regulation heights in metres:\n")
  print(summary(mag$regh))
}
```

The median regulation height is almost 5&nbsp;metres, the maximum more than 100&nbsp;metres. 
Unfortunately, there are many missing values. 
We will have to simulate them based on the data that are available. 

### 9.2 Simulating regulation heights

To do so, we first need to look at the difference between hydropower reservoirs and other ones.

```{r}
#| lab: hist-fig
#| fig-cap: "Water level regulation heights differ between hydropower and other reservoirs.<br />(Note that the x-axis is logarithmic.)"

mag$power <- mag$formal_L == "Kraftproduksjon"
w0 <- which(!mag$power & mag$status == "D")
w1 <- which( mag$power & mag$status == "D")

par(mai = c(0.96, 0.84, 0.84, 0.12))
hist(lg(mag$regh[w1]), breaks = 25, col = rgb(0.5, 0.5, 1, 0.5),
     ylim = c(0, 100), xaxt = "n", xlab = "Regulation height (m)",
     main = "Histogram of regulation height",
     cex.main = 1.5, cex.lab = 1.2)
hist(lg(mag$regh[w0]), breaks = 25, col = rgb(1, 0.5, 0.5, 0.5), add = TRUE)
xp <- c(0.1, 0.3, 1, 3, 10, 30, 100)
axis(1, lg(xp) - 0.05, xp)

rect(-1, 80, -0.9, 85, col = rgb(0.5, 0.5, 1, 0.5))
rect(-1, 70, -0.9, 75, col = rgb(1, 0.5, 0.5, 0.5))
text(-0.9, 82, "hydropower", pos = 4)
text(-0.9, 72, "other reservoirs", pos = 4)
```

Unknown regulation heights can be simulated by drawing values at random from the known distributions. 
The figure shows that simulations will have to be done separately for hydropower and other reservoirs. 

Some unknown regulation heights may be estimable with somewhat more accuracy, however. 
This can be achieved by approximating unknown regulation heights based on known reservoir volumes and reservoir areas. 
The relationship between the two is noisy but clear.

```{r}
#| lab: areavol-fig
#| fig-cap: "Lake area and dammed volume of reservoirs are clearly related, allowing a prediction of unknown regulation heights.<br />(Note that both axes are logarithmic.)"

mod0 <- lm(lg(volOppdemt) ~ lg(areal_km2) * power, data = mag, 
           subset = volOppdemt > 0 & areal_km2 > 0 & status == "D")

plot(lg(mag$areal_km2[c(w0, w1)]), lg(mag$volOppdemt[c(w0, w1)]),
     xaxt = "n", yaxt = "n", type = "n",
     xlab = "Lake area (m²)", ylab = "Dammed volume (m³)",
     main = "Area and volume of reservoirs",
     cex.main = 1.5, cex.lab = 1.2)
points(lg(mag$areal_km2[w1]),       lg(mag$volOppdemt[w1]),      col = "blue")
abline(mod0$coef[1] + mod0$coef[3], mod0$coef[2] + mod0$coef[4], col = "blue")
points(lg(mag$areal_km2[w0]),       lg(mag$volOppdemt[w0]),      col = "red")
abline(mod0$coef[1],                mod0$coef[2],                col = "red")
akser <- c(expression(10^4), expression(10^5), expression(10^6), 
           expression(10^7), expression(10^8), expression(10^9))
axis(1, seq(-2, 3, 1), akser)
axis(2, seq(-2, 3, 1), akser)
text(1.5, -0.5, "R² = " %+% round(summary(mod0)$r.sq, 3), pos = 4)
text(1.5, -1.0, "blue: hydropower",      pos = 4, col = "blue")
text(1.5, -1.5, "red: other reservoirs", pos = 4, col = "red")
```

From this relationship we can predict regulation heights for quite some reservoirs. 
The predicted values are well correlated with the actual ones (only regarding lakes where the latter are known).

```{r}
#| lab: infer-fig
#| fig-cap: "When regulation height is predicted from reservoir area and volume, the predicted values are well correlated with actual ones. (Note that both axes are logarithmic.)"

mag$logh <- lg(mag$regh)
mag$esth <- lg(mag$volOppdemt / sapply(mag$areal_km2, max, 0.0025))
mag$esth[which(is.infinite(mag$esth))] <- NA

mod1 <- lm(logh ~ esth * power, data = mag, subset = regh > 0 & status == "D")
mod2 <- lm(esth ~ logh * power, data = mag, subset = regh > 0 & status == "D")

w <- which(mag$status == "D" & !is.na(mag$regh) & is.finite(mag$logh))
plot(mag$logh[w], mag$esth[w], 
     xaxt = "n", yaxt = "n", type = "n",
     xlab = "Actual regulation height (m)", 
     ylab = "Estimated regulation height (m)",
     main = "Inferred regulation height",
     cex.main = 1.5, cex.lab = 1.2)
points(mag$logh[w1], mag$esth[w1], col="blue")
abline(mod2$coef[1] + mod2$coef[3], mod2$coef[2] + mod2$coef[4], col="blue")
points(mag$logh[w0], mag$esth[w0], col="red")
abline(mod2$coef[1]               , mod2$coef[2]               , col="red")
axis(1, lg(xp), xp)
axis(2, seq(-2, 3, 1), 10^seq(-2, 3, 1))
text(1.25, -1.0, "R² = " %+% round(summary(mod2)$r.sq, 3), pos = 4)
text(1.25, -1.4, "blue: hydropower",      pos = 4, col = "blue")
text(1.25, -1.8, "red: other reservoirs", pos = 4, col = "red")
```

Now we can run 1000 simulations for each reservoir. 
Regulation heights are calculated, inferred or estimated as follows:

* If the upper and lower regulation levels are reported in the NVE dataset, regulation height is simply the difference between the two.
* If lake area and dammed volume are reported in the NVE dataset, 1000 random numbers are produced based on the prediction interval of the model explaining regulation height as volume divided by area (separately for hydropower and other reservoirs, and constraining regulation heights upwards to the upper limit of the actual distribution within these two categories).
* If none of the above is known, regulation height is drawn 1000 times at random from the actual distribution of known regulation heights (separately for hydropower and other reservoirs).

Furthermore, each reservoir is coupled to the respective lake entry in NVE's lake database. 
This adds precise knowledge of the areas of all lakes and reservoirs.

```{r}
nsim <- 1000
# The values tabulated in the "Results" section were obtained using nsim = 10000

nve$drift <- 0
nve$regh  <- 0
regh <- matrix(0, nrow(nve), nsim, dimnames = list(nve$lnr, "sim" %+% 1:nsim))
samplePower <- mag$regh[which(!is.na(mag$regh) & mag$status == "D" &  mag$power)]
sampleOther <- mag$regh[which(!is.na(mag$regh) & mag$status == "D" & !mag$power)]
set.seed(144)

for (i in 1:nrow(mag)) {
  # couple records using NVE's reservoir number 
  w <- which(nve$mnr == mag$magasinNr[i])
  if (!length(w)) {
    # couple records using NVE's lake identifier
    w <- which(nve$lnr == mag$vatnLnr[i])
  }
  if (length(w) > 1) {
    for (j in length(w):1) {
      # if more than one hit, remove the one with the wrong water region number
      if (!(mag$vassdragNr[i] %inneholder% nve$omrade[w[j]])) {
        w <- w[-j]
      }
    }
  }
  if (length(w) > 1) {
    for (j in length(w):1) {
      # if still more than one hit, use lake identifier rather than reservoir number
      if (mag$vatnLnr[i] %!=% nve$lnr[w[j]]) {
        w <- w[-j]
      }
    }
  }
  if (length(w) %=% 1 & 
      mag$status[i] == "D") {
    nve$drift[w] <- mag$idriftAar[i]
    if (is.na(mag$regh[i])) {
      SAMPL <- if (mag$power[i]) samplePower else sampleOther
      if (is.na(mag$esth[i])) {
        # resample the known regulation heights if no other data are available
        nve$regh[w] <-  max(median(SAMPL), 0.01)
        regh[w, ] <- sapply(sample(SAMPL, nsim, TRUE), max, 0.01)
      } else {
        # infer regulation height from reservoir area and volume
        pred <- predict(mod1, data.frame(esth = mag$esth[i], power = mag$power[i]), 
                        interval = "prediction", level = 0.95)[1, ]
        nve$regh[w] <- max(min(10^pred[["fit"]], max(SAMPL)), 0.01)
        pred <- pred[["fit"]] + 
          rt(nsim, mod1$df) * (pred[["upr"]] - pred[["fit"]]) / qt(0.975, mod1$df)
        pred <- sapply(10^pred, min, max(SAMPL))
        regh[w, ] <- sapply(round(pred, 1), max, 0.01)
      }
    } else {
      # use precise regulation height if it is known
      regh[w, ] <- rep(max(0.01, mag$regh[i]), nsim)
      nve$regh[w] <-   max(0.01, mag$regh[i])
    }
  }
}

{# summarise results
  NumbL <- nrow(nve)
  AreaL <- sum(nve$areal, na.rm = TRUE)
  NumbR <- length(which(nve$regh > 0))
  AreaR <- sum(nve$areal[which(nve$regh > 0)], na.rm = TRUE)
  Q <- quantile(apply(regh, 2, weighted.mean, nve$areal, na.rm = TRUE), 
                c(0.25, 0.50, 0.75))
  
  skriv("Summary:")
  skriv("Norway has ", 
        NumbR, " dammed reservoirs. This amounts to ", 
        formatC(100 * NumbR / NumbL, form = "f", dig = 1), "% of Norway's ", 
        NumbL, "_lakes (disregarding ones that are smaller than 2500_m²).", 
        pre = "* ", Bredde = 84)
  skriv("These reservoirs have a cumulative area of ", 
        round(AreaR), "_km². This amounts to ", 
        formatC(100 * AreaR / AreaL, form = "f", dig = 1), 
        "% of the lake-covered area of Norway (which is ", 
        round(AreaL), "_km²).", pre = "* ", Bredde = 84)
  skriv("The area-weighted average regulation height across Norwegian lakes, ",
        "including unregulated ones, amounts to approximately ", 
        formatC(Q[2], form = "f", dig = 2), "_m. ", 
        "This estimate has an interquartile range from ", 
        formatC(Q[1], form = "f", dig = 2), "_m to ", 
        formatC(Q[3], form = "f", dig = 2), "_m ",
        "(being a measure of its uncertainty).", pre = "* ", Bredde = 84)
}
```

We define a new variable for the region of Norway (*landsdel*) in which the reservoir is situated. 
This is inferred from the ID number of the respective water region (*vannområde*).

```{r}
# Defining a column for the region of Norway, 
# based on the water region ("vannområde")
nve$ldel <- NA
omr <- as.numeric(nve$omrade)
nve$ldel[omr %mellom%   1:15]  <- "Ø"
nve$ldel[omr %mellom%  16:26]  <- "S"
nve$ldel[omr %mellom%  27:91]  <- "V"
nve$ldel[omr %mellom%  92:143] <- "M"
nve$ldel[omr %mellom% 144:306] <- "N"
nve$ldel[omr %mellom% 307:309] <- "M"
nve$ldel[omr %mellom% 310:315] <- "Ø"
rm(omr)
```

### 9.3 Calculating mEQRs using reference levels

According to the WFD and DGVF ([2025](#veil2)), measurements of WFD variables are transformed into so-called nEQR values ("normalised Ecological Quality Ratios") between 0 and 1, which correspond to indicator values sensu [SEEA&nbsp;EA](#seeaea). 
This procedure is here somewhat modified by calculating mEQR values ("modified Ecological Quality Ratios") that retain the full variation of the underlying variable (for details, [see above](#spatial-aggregation) and [Sandvik 2019](#san19), [Sandvik 2025](#san25)).

The following graph shows the scaling and transformation of the indicator. 
Transformation is done using the reference levels for water level regulation (more specific, its effects on the fish fauna) as listed in DGVF ([2025](#veil2), Table 6.19).
The graph uses the WFD colour coding for ecological status classes.

```{r}
#| lab: meqr-fig
#| fig-cap: "Scaling and transformation from variable measurements to mEQR values."

xlim <- c(0, 50)
xaxis <- seq(0, 50, 10)
yaxis <- seq(-0.2, 1.2, 0.2)
x <- seq(min(klassegrenser), max(klassegrenser), le = 1000)
y <- mEQR(x, klassegrenser)
forklar <- "Original variable values (m)"
plot(x, y, ty = "l", main = "Water regulation height",
     xlim = xlim,         xaxs = "r", xaxt = "n", xlab = forklar,
     ylim = c(-0.2, 1.2), yaxs = "r", yaxt = "n", ylab = "mEQR values",
     cex.main = 1.5, cex.lab = 1.2)
rect(xlim[1]-144,-0.4, xlim[2]+144, 0.0, col = rgb(0.0, 0.0, 0.0, 0.1), border = NA)
rect(xlim[1]-144, 0.0, xlim[2]+144, 0.2, col = rgb(1.0, 0.0, 0.0, 0.2), border = NA)
rect(xlim[1]-144, 0.2, xlim[2]+144, 0.4, col = rgb(1.0, 0.5, 0.0, 0.2), border = NA)
rect(xlim[1]-144, 0.4, xlim[2]+144, 0.6, col = rgb(1.0, 1.0, 0.0, 0.2), border = NA)
rect(xlim[1]-144, 0.6, xlim[2]+144, 0.8, col = rgb(0.0, 1.0, 0.0, 0.2), border = NA)
rect(xlim[1]-144, 0.8, xlim[2]+144, 1.0, col = rgb(0.0, 0.0, 1.0, 0.2), border = NA)
rect(xlim[1]-144, 1.0, xlim[2]+144, 1.4, col = rgb(0.5, 0.0, 1.0, 0.1), border = NA)
lines(c(xlim[1] - 144,    klassegrenser[7]), c(+1, 1), lwd = 1.5, col = "blue")
lines(c(klassegrenser[7], klassegrenser[7]), c(-1, 1), lwd = 1.5, col = "blue")
lines(c(xlim[1] - 144,    klassegrenser[2]), c(+0, 0), lwd = 1.5, col = "red")
lines(c(klassegrenser[2], klassegrenser[2]), c(-1, 0), lwd = 1.5, col = "red")
lines(x, y, lwd = 3)
axis(1, xaxis, erstatt(xaxis, "-", "−"), cex.axis = 0.9)
axis(2, yaxis, c("−0.2", "0.0", 0.2, 0.4, 0.6, 0.8, "1.0", 1.2), cex.axis = 0.9)
text(xlim[2], seq(0.1, 0.9, 0.2), c("bad", "poor", "moderate", "good", "high"), 
     pos = 2, offset = 0)
rf <- klassegrenser[7] > klassegrenser[2]
text(klassegrenser[2], -0.15, expression(X[0]),   pos=ifelse(rf, 4, 2), offset=0.3)
text(klassegrenser[7], -0.15, expression(X[100]), pos=ifelse(rf, 2, 4), offset=0.3)
```

Note that variable values may be substantially poorer (larger) than X~0~ (red line). 
An asymptotic transformation is used for X > X~0~ in order to keep mEQR values above &minus;0.2.

### 9.4 Estimating the indicator values and their uncertainty

The transformation shown above is now applied to the (actual and simulated) regulation heights. 
In a final step, quantiles of the nEQR values are estimated for the different regions of Norway and different years.

```{r, results=FALSE, message=FALSE}
for (i in which(regh[, 1]  > 0)) regh[i, ] <- mEQR(regh[i, ], klassegrenser)
regh[which(regh[, 1] == 0), ] <- 1 # mEQR(0, klassegrenser) = 1

QNTL <- c(0.025, 0.25, 0.5, 0.75, 0.975)
years <- 1890:2024

regions <- matrix(0, 6, length(QNTL), dimnames = list(c("WholeCountry", "Østlandet", 
                    "Sørlandet", "Vestlandet", "Midt-Norge", "Nord-Norge"),
                    "Q" %+% QNTL))
regions["WholeCountry",] <- quantile(apply(regh, 2, weighted.mean, nve$areal), QNTL)
for (L in rownames(regions)[-1]) {
  w <- which(nve$ldel == substr(L, 1, 1))
  regions[L, ] <- quantile(apply(regh[w, ], 2, weighted.mean, nve$areal[w]), QNTL)
}

figure <- matrix(0, length(QNTL), length(years), 
                 dimnames=list("Q" %+% QNTL, "Y" %+% years))
nve$areal[is.na(nve$areal)] <- 0
w <- which(nve$regh < 0.001)
nve1 <- nve[1, ]
nve1$areal <- sum(nve$areal[w])
nve1$drift <- 0
nve <- nve[-w, ]
nve <- rbind(nve1, nve)
regh <- regh[-w, ]
regh <- rbind(rep(1, nsim), regh)
sink(tempfile())
gc(verbose = FALSE)
sink()
for (j in rev(years)) {
  w <- which(nve$drift >= j + 1)
  if (length(w)) {
    nve$areal[1] <- nve$areal[1] + sum(nve$areal[w])
    nve  <-  nve[-w, ]
    regh <- regh[-w, ]
  }
  figure[, "Y" %+% j] <- quantile(apply(regh, 2, weighted.mean, nve$areal), QNTL)
}
```

### 9.5 Summary of the output

The estimates and their confidence intervals may be summarised as tables ...

```{r}
print(regions)
```

... or as figures.

```{r}
#| lab: indicator-fig
#| fig-cap: "Changes in the national indicator value for water level regulation from 1900 to 2024. The black line is the best estimate (median); the interquartile range is shown as a grey area (barely visible behind the black line); and 95% confidence intervals are shown as thin grey lines."

plot(years, figure["Q0.5", ], ty="l", xlim = c(1900, 2024), ylim=c(0.75, 1),
     xlab = "Year", ylab = "Indicator value", main = "Water level regulation",
     cex.main = 1.5, cex.lab = 1.2)
polygon(c(years, rev(years)), c(figure["Q0.25", ], rev(figure["Q0.75", ])), 
        border = NA, col = grey(0.84))
lines(years, figure["Q0.025", ], col = grey(0.84))
lines(years, figure["Q0.975", ], col = grey(0.84))
abline(h = c(1, 0.9, 0.8), col = "blue", lty = 3)
lines(years, figure["Q0.5", ], lwd = 1)
```

<!--# 
Use this header for documenting the analyses. Put code in separate code chunks, and annotate the code in between using normal text (i.e. between the chunks, and try to avoid too many hashed out comments inside the code chunks). Add subheaders as needed. 

Code folding is activated, meaning the code will be hidden by default in the html (one can click to expand it).

Caching is also activated (from the top YAML), meaning that rendering to html will be quicker the second time you do it. This will create a folder inside you project folder (called INDICATORID_cache). Sometimes caching created problems because some operations are not rerun when they should be rerun. Try deleting the cash folder and try again.
-->


## 10. Results

As the scaling function used is non-linear, aggregated averages of *unscaled* values (*variable* values sensu SEEA&nbsp;EA) are not informative. 
Therefore, this indicator is reported in terms of *scaled* values only (nEQR sensu WFD; *indicator* values sensu SEEA&nbsp;EA).

The results are here tabulated (a) for the whole country and different years, and (b) for regions in 2024. 
These estimates are based on 10,000 simulations and therefore differ from the ones above.


| Year | Best estimate | Lower quartile | Upper quartile |
|:-----|:-------------:|:--------------:|:--------------:|
| 2024 | 0.797         | 0.796          | 0.799          |
| 1994 | 0.807         | 0.806          | 0.809          |
| 1964 | 0.887         | 0.886          | 0.889          |
| 1934 | 0.961         | 0.960          | 0.961          |
| 1904 | 0.993         | 0.992          | 0.993          |

: Water level regulation indicator values for Norwegian lakes in different years {.striped .hover}

&nbsp;

| Region     | Best estimate | Lower quartile | Upper quartile |
|:-----------|:-------------:|:--------------:|:--------------:|
| Østlandet  | 0.807         | 0.806          | 0.808          |
| Sørlandet  | 0.743         | 0.742          | 0.744          |
| Vestlandet | 0.734         | 0.731          | 0.736          |
| Midt-Norge | 0.790         | 0.787          | 0.794          |
| Nord-Norge | 0.847         | 0.843          | 0.851          |

: Water level regulation indicator values for lakes in regions of Norway in 2024 {.striped .hover}

<!--# 
Repeat the final results here. Typically this is a map or table of indicator values.

This is typically where people will harvest data from, so make sure to include all relevant output here, but don't clutter this section with too much output either.
-->

<!--# 
## 11. Export file

Optional: Display the code (don't execute it) or the workflow for exporting the indicator values to file. Ideally the indicator values are exported as a georeferenced shape or raster file with indicators values, reference values and errors. You can also chose to export the raw (un-normalised or unscaled variable) as a seperate product. You should not save large sptaial output data on GitHub. You can use eval=FALSE to avoid code from being executed (example below - delete if not relevant) 
-->

```{r export}
#| eval: false
```
